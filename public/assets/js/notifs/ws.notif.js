// Generated by CoffeeScript 1.12.5

/*
WebSocket Notification class.
Refer to the layout view.
 */

(function() {
  this.WsNotif = (function() {
    function WsNotif(wsUri, topicUri) {
      var conn, ctx, protocol;
      if (window.location.protocol === 'http:') {
        protocol = 'ws:';
      } else {
        protocol = 'wss:';
      }
      wsUri = protocol + "//" + wsUri;
      ctx = this;
      conn = new ab.Session(wsUri, function() {
        return conn.subscribe(topicUri, function(topic, data) {
          return ctx.onSub(topic, data);
        });
      }, function() {
        return console.log('something went wrong.');
      }, {
        'skipSubprotocolCheck': true
      });
    }

    WsNotif.prototype.onSub = function(topic, data) {
      var title, url, value;
      title = 'Git Test';
      value = 1;
      url = 'http://www.google.com';
      return this.render(title, value, url);
    };


    /*
    @param  string  title  The string to compare to, in order
    to render a new notification.
    @param  string  value  The string to render. This will be
    used by the title once there's a new notification to be 
    rendered.
    @param  string  url
     */

    WsNotif.prototype.render = function(title, value, url) {
      var i, oNotif, sProj, sTitle;
      sProj = '.sidebar-menu .treeview-menu.projects';
      sTitle = sProj + " li > a > span";
      i = $(sTitle + ":contains('" + title + "')").length;
      if (i > 0) {
        oNotif = $(sProj + " #notif.project a");
        return oNotif.html(value);
      }
    };

    return WsNotif;

  })();

  $(document).ready(function() {
    return new WsNotif($('#push-notif').data('host'), $('#push-notif').data('topic'));
  });

}).call(this);
